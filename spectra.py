import astropy.io.fits
import numpy as np
import matplotlib.pyplot as plt

#fits  = astropy.io.fits.open('1402090027021623.fits')

fast_slow = np.array([[160524004201215, 170911002601172],[160524004201330, 170506002901289],[160524004201377, 181221002101347],[150829005701369, 170602002701388],[170128001601331, 140607001401105],[170128002901238, 160529002401214],[190211002201339, 161008002501089],[140809004901265, 140810005901078],[140810003701146, 170801004601075],[170712003601249, 170909003801174],[170712002601360, 140611004001392],[170130002601216, 160530003901236],[150831002001119, 160513001601261],[190212003501293, 170102001901149],[140811002101371, 170711003501293],[140811002701011, 170906003101197],[170712005301240, 161013003201038],[190223002801282, 170216003801229],[140811005601180, 170130004101221],[150901002401237, 170507007801373],[170202002701033, 160518004001018],[160530003901013, 170418005201012],[150902003701118, 160811004001391],[170205004401090, 170907003601008],[190225003201053, 190210001601008],[170723003601092, 170511001101273],[170205004901055, 140811005601270],[160531002601324, 150409007601193],[160531006101055, 150824002601041],[170206005701299, 140415002101335],[170801002501099, 160530003301203],[160723002001222, 170604005101018],[170801004001080, 180101001601230],[141101002401104, 160129003101112],[151111004301046, 151229004001213],[151111004301307, 141101001801036],[141102003201181, 190210003001329],[141103002601119, 170516002801316],[141103002601356, 170806004701318],[151219004101177, 151229003501328],[141103003601362, 140814003801190],[170805005101352, 160331002701173],[141104003801071, 181225003601026],[160813005101360, 151008002601196],[170806002101193, 150330002601036],[170219003101251, 171101000701198],[170806003201015, 170407005701179],[170219004701120, 170712004201148],[170806004701317, 160515002801059],[170220003101101, 170511004001273],[170220003101102, 170516001601242],[151227004202017, 150826002101280],[151227004202136, 180103001601092],[151227004202135, 170114004101393],[151227004202165, 160529002401316],[151227004202331, 151229004501224],[151227005201318, 160923004701168],[151227005201377, 160417002201171],[141231004001120, 170206005201256],[160816002701098, 190223003301310],[160816003201128, 170603008301160],[151229003501367, 150112002501223],[151229005001052, 140312004501162],[160816004701136, 150209003901283],[170905002101095, 161119005201115],[170404001601057, 170907004601370],[150103003501140, 181225004601010],[151231003201320, 161011002801099],[170407002601294, 170910005101063],[170906004601259, 190225003201339],[170407004101192, 160112002301059],[170906005601181, 140810005901270],[160919004001111, 170602002701017],[170907002601295, 160518000901015],[170408004001042, 171001002401301],[160108002601016, 140807005001036],[170907004101195, 170413005101273],[170907004601063, 150703005601364],[150107002201269, 170712005301234],[170907005201206, 160522006601026],[170908001601388, 171227001601006],[160923004701038, 171001002401045],[170409002601212, 190207003201012],[150107004201277, 160530003301001],[150108001001303, 170806003201248],[170410003301221, 150830004601014],[160112001601244, 161008004001077],[160112002301314, 171227003601218],[170909003801392, 161228003501374],[160111002601273, 160113002101064],[160112002301392, 171101000701152],[170411001601072, 170407003601151],[160113002101238, 180126002101102],[150204002901101, 170107004201351],[160124002601203, 150208004201367],[161009005301166, 171101001801117],[150206002601186, 150101003401154],[170413002101062, 170118003801327],[170413002101162, 170907002601271],[161012002601313, 170712004201148],[161012003201033, 150101002501244],[161013002101326, 160522004101236],[150208002701007, 150205005801383],[170414002101176, 160422002501289],[170414003101292, 141104003301057],[160325002101394, 160815004801271],[170415003601038, 190211003801343],[170415004101184, 160531002601215],[161106001601270, 171102002101119],[150211002701260, 161115002701261],[150211003201224, 190206006701257],[160328000701357, 160811002601146],[150211004701184, 160107003101323],[171102003301374, 170512000701188],[171102003901025, 151219003601187],[170417004001258, 150831005001172],[170418001601109, 150102003201178],[171104002302109, 160919004001392],[140209002702162, 160420005301034],[161109003901319, 140811002101318],[140303001002237, 170712002601351],[171106003601341, 160325004201219],[150407001101211, 170216002301046],[161116004401144, 170724003601043],[160331005301360, 140611002501275],[170506006901038, 170905002101134],[171206002602348, 150405003401036],[171206003102365, 141231002501228],[160401002601240, 131116000501397],[160401002601269, 171106003601371],[150408004701109, 161012002101237],[150408004701261, 170122003101048],[160401003401199, 140114004201085],[150408005301103, 141102002401172],[150408005301151, 150830005601248],[171208002102316, 140314004002053],[171208002602316, 181223003001225],[140312003001140, 170802004301242],[170508004801355, 150108002801399],[171227004101021, 150107004201333],[171227004101135, 161119005201115],[170509002201080, 170531002301321],[160403005201157, 170802003201307],[140314003202269, 170910003601030],[150412003601095, 140707003601245],[170509004701381, 150829005701365],[140315002102097, 141103003101394],[161209002901242, 150405001501044],[170509006201399, 131218002401178],[161211003101228, 150827005201136],[170510002301297, 140707000101341],[161211003901140, 170216003801293],[171230004101234, 170906003602087],[140409001401376, 160328004201319],[170510005301383, 160419003601073],[170510006301042, 170530002101031],[160418005601030, 150830002801253],[161217003601083, 150208005201090],[180102001601047, 170411003101298],[140412001701292, 171208003602126],[170511001101344, 181221003101334],[170511002601344, 170507006701361],[140413002701166, 151009003601124],[170511004001304, 150208003201386],[170511004001329, 170416005301009],[160420003301220, 171003003601342],[170512000701098, 161009003201013],[140413004401261, 160519003601207],[160420004301365, 150829005701186],[180125001901168, 160123002601129],[170512001801278, 140713004001076],[160420005301368, 160426004501201],[161219004101025, 170408004501080],[160420006301164, 161009004301024],[140414003101060, 181225003601313],[180129003601008, 161013002101188],[170513004001312, 150602002101002],[170513004001385, 160518002901037],[170513004901379, 170219003101271],[140415002101093, 161119004701128],[180604005701368, 170409002601277],[180604006201256, 150430003301394],[180604006201344, 181221003101040],[170102002301301, 151229003501267],[170102002301377, 140807005601296],[160422003501237, 170906004601152],[150602005501382, 160415004101212],[150603001801151, 170905002101369],[150603001801223, 170603002601110],[170104002101375, 140611003001202],[150603001801347, 181222004101305],[160422004501079, 170414004101286],[140609003601168, 170912002901178],[170516000601397, 170604005101366],[170104002901287, 160531002601387],[140609004901285, 160518003401089],[170516001601176, 160325003701326],[140610003901028, 170516001601028],[160423003201108, 170410002701122],[150604002401018, 150108002801220],[170105002601107, 150107002201025],[150604003901191, 170410003901133],[170105004101077, 170908002801075],[170105004101138, 131116000501089],[170517002301134, 170602006201355],[160424004701354, 160530004501381],[160424005701213, 171102002101381],[150606002901379, 181222002101282],[160425003401298, 150607004601325],[140707001601103, 150603001801313],[150606005901220, 160520002601351],[150607002601276, 160520003101348],[181221002601006, 141102003201195],[181221003101282, 160529004201399],[160512005101004, 140209002702255],[181221003601210, 140809002101031],[150607005101018, 170205004901196],[160513002601104, 170711002001126],[140709003801337, 160425002501357],[150607005601289, 150103004001174],[150703001601074, 160109002701038],[160514002801205, 160325004201057],[181222003101207, 170410003301061],[181222004101251, 140412001201045],[181222004601367, 170516003601039],[140711004402233, 150430001801022],[140713002401227, 141104003801127],[170114003101012, 170105002101025],[181223003501288, 170105004101060],[181223004501076, 160816003701255],[181224001601080, 161210003401057],[181224002601313, 160129004701201],[170115003201341, 160530002201178],[160519003101296, 161118003501167],[160519004101312, 150824003101284],[140806001701209, 170508002601034],[170604005601342, 150828003201368],[140806002301088, 150209004501077],[170117003101122, 160816003201038],[170117003101279, 150604002401294],[181226002601352, 150408005901221],[150827002901095, 140414002601026],[181226003101319, 150106002201229],[170119003601030, 160426005001033],[170119003601149, 170418003701006],[170119003601295, 170219003601025],[181226004101023, 170122003101018],[160522004101138, 160816002701138],[170121002201313, 161009003201341],[150829003101303, 170906004601207],[150828004701327, 160514003301311],[150828004702328, 160420005801099],[190207002701177, 190225004201371],[140808003201376, 151229003002268],[160522006601085, 170513004901288],[190207002701339, 150430002301154],[140808003701031, 160919003001214],[170122003601202, 170602006201081]])


sped_ratio = np.array([ 3.71193967,  4.28790291,  3.77145053,  7.87190458,  4.17251898, 18.5209367 , 11.61425044, 11.33523313,  9.4335904 ,  3.76452293,  4.00365892,  5.48264044,  4.07187288,  3.94875045,  3.48989134,  7.2972833 ,  5.3381068 , 13.66029337,  4.9429012 ,  4.89041002,  5.34992235,  6.94999419,  4.56972118,  8.11303623,  5.06806665,  6.46452241,  7.4841687 ,  7.52883364,  6.65277183,  4.12220209, 24.48847034,  4.93222382,  4.69274169,  4.69969229,  5.29095338,  8.92962926,  4.3365441 ,  3.56105504,  3.87079371,  5.8710312 ,  7.34199863, 14.31575878, 12.43802407,  7.71068049,  5.46278449,  9.74648778, 21.35207321,  3.47390045,  4.42751606,  6.21919131, 10.65479406,  7.59976162,  3.55289765,  3.28342104, 12.41869774, 13.25548739, 11.20453552,  6.62327208,  7.40279912,  4.92637432,  4.92223253,  8.75225413,  8.30100254,  5.9866737 ,  4.65745075,  3.64880139, 10.27962134, 10.43727402, 13.72036494, 10.1316738 ,  5.54045722,  4.12722535,  4.15781072,  6.60441162,  4.25878531, 20.35495317,  6.16894642, 17.30066707,  7.11609252,  4.24626588,  3.49564625,  7.42749655,  8.52489043, 13.15369687, 15.848612  , 12.73472085,  4.07515461, 12.39915727,  4.43036774, 13.99830406,  9.685871  ,  5.57980016,  5.30636894,  6.24345752, 15.96777138, 12.38334266,  6.27544457, 14.06210145,  9.61734353,  5.49360642,  5.72967529,  6.37633701,  5.38330146,  6.40157306,  4.2276273 ,  4.01915946,  5.37244515, 10.7508431 , 38.89307118,  4.63521736,  3.33449986,  5.35597551, 16.47434573,  4.83565428,  4.38480522,  7.60984788,  5.08372934,  5.0002204 ,  4.77423688,  3.38306705,  4.0378991 ,  7.2020756 ,  4.67463211,  5.79343977,  6.1254341 , 16.80460288,  4.61015425,  4.47527299,  4.16367508,  8.32664249,  4.8193802 ,  5.68974653,  5.34663283, 20.43044686,  6.96112826,  5.1648905 ,  4.98724225,  7.20587201,  3.75133878,  7.21771284,  4.61168097, 15.47702352,  7.83572756, 10.61545778, 14.02875879,  4.15061154,  5.81383508,  5.58832659,  8.62767892,  3.10314905, 10.48429801,  4.71822314, 19.37083485,  4.32054368,  6.00841477,  4.91592179,  5.92495061,  6.97221882,  3.78414863,  8.82060876,  4.76190101,  4.5264915 ,  8.82350716,  3.83573936,  6.91214242,  4.14321557,  4.62978537,  5.24317947,  5.94223927,  7.4247617 ,  7.44448403,  8.20326147, 13.90200264, 11.90223951,  6.90998353, 14.46308881,  4.89874953, 14.36258964, 13.5235332 ,  7.67155739,  8.29018443,  5.10830236,  4.11808495, 10.1289323 ,  4.8486175 ,  6.19493246,  4.66380423,  4.94434839,  7.13110765,  6.07515962,  5.17490688,  7.43164189,  6.37056437,  4.56746661,  4.59132516,  4.69846422,  4.67532111,  5.99841773,  7.49915445,  4.75958433,  6.76092986, 14.05751378,  6.97093611,  4.09124697,  5.28632501,  6.34765611,  4.76879528, 18.06218657,  4.57002898,  7.14954599,  7.24170172,  5.58673938,  5.31712162,  5.96570474,  8.01490606,  7.7470286 , 14.12559598,  3.69500223,  4.39655807,  4.37377611,  6.36708256,  4.38740721,  7.1751233 ,  9.20219062,  5.31599166,  6.99806505,  7.9702299 ,  6.52257251,  7.1790207 , 11.96740054,  7.25673869,  4.92790985,  6.46591471,  5.61466891,  5.62188828,  6.4909089 ,  3.40178195,  3.83935612,  8.72102857, 13.69394395,  6.73265228,  8.89450467,  6.56946095, 18.75895435,  5.59427118,  4.6980282 , 12.44004187,  9.44498609,  4.0279374 ,  8.36526422,  4.28878959,  6.23831152,  7.81934379,  7.80989535, 21.15233091,  7.85492426, 28.78075704,  6.46349376])

import glob
for k,pair in enumerate(fast_slow):
    try:
        fast_file = str(pair[0])+'3.fits'
        slow_file =str(pair[1])+'3.fits'


        fits  = astropy.io.fits.open(fast_file)
        spectrum = dict()
        start_wavelength = fits[4].header["CRVAL1"]
        dispersion = fits[4].header["CDELT1"]
        nr_pixels  = fits[4].header["NAXIS1"]
        reference_pixel  = fits[4].header["CRPIX1"]
        if reference_pixel == 0:
            reference_pixel=1
        spectrum['wave_norm_'+str(3)] = ((np.arange(0,nr_pixels)--reference_pixel+1)*dispersion+start_wavelength)
        wavelength_array = spectrum['wave_norm_3']

        #plt.open()
        plt.figure()
        plt.title(str(pair) + '. vsini ratio = ' + str(sped_ratio[k]))
        plt.plot(wavelength_array,fits[4].data,label='Fast')



        fits  = astropy.io.fits.open(slow_file)
        spectrum = dict()
        start_wavelength = fits[4].header["CRVAL1"]
        dispersion = fits[4].header["CDELT1"]
        nr_pixels  = fits[4].header["NAXIS1"]
        reference_pixel  = fits[4].header["CRPIX1"]
        if reference_pixel == 0:
            reference_pixel=1
        spectrum['wave_norm_'+str(3)] = ((np.arange(0,nr_pixels)--reference_pixel+1)*dispersion+start_wavelength)
        wavelength_array = spectrum['wave_norm_3']

        #plt.open()
        plt.xlim(6550,6580)
        plt.ylim(0,1.1)
        plt.plot(wavelength_array,fits[4].data,label = 'Slow')
        plt.xlabel('Wavelength (Angstrom)')
        plt.ylabel('Normalised Continuum Flux')


        plt.legend(loc = 'best')


        plt.savefig(str(pair)+'.png')
        plt.close()
        fits.close()
    except:
        print(str(pair))
